// Automatically generated by PRGA's RTL generator
{% macro memport(portsuffix, addr_width, data_width) -%}
    , input wire [{{ addr_width - 1 }}:0] addr{{ portsuffix }}
    , input wire [{{ data_width - 1 }}:0] data{{ portsuffix }}
    , input wire [0:0] we{{ portsuffix }}
    , output reg [{{ data_width - 1 }}:0] out{{ portsuffix }}
{%- endmacro -%}
{% macro memproc(portsuffix, addr_width, transparent) -%}
    // convert 'x' or 'z' to '0' in simulation
    reg internal_we{{ portsuffix }};
    reg [{{ addr_width - 1 }}:0] internal_addr{{ portsuffix }};

    always @* begin
        internal_we{{ portsuffix }} = we{{ portsuffix }};
        internal_addr{{ portsuffix }} = addr{{ portsuffix }};

        // synopsys translate_off
        if (we{{ portsuffix }} === 1'bx || we{{ portsuffix }} === 1'bz) begin
            internal_we{{ portsuffix }} = 1'b0;
        end
        {% for i in range(addr_width) %}
        if (addr{{ portsuffix }}[{{ i }}] === 1'bx || addr{{ portsuffix }}[{{ i }}] === 1'bz) begin
            internal_addr{{ portsuffix }} = 1'b0;
        end
        {%- endfor %}
        // synopsys translate_on
    end

    always @(posedge clk) begin
        {% if transparent -%}
        if (internal_we{{ portsuffix }}) begin
            mem[internal_addr{{ portsuffix }}] <= data{{ portsuffix }};
            out{{ portsuffix }} <= data{{ portsuffix }};
        end else begin
            out{{ portsuffix }} <= mem[internal_addr{{ portsuffix }}];
        end
        {%- else -%}
        if (internal_we{{ portsuffix }}) begin
            mem[internal_addr{{ portsuffix }}] <= data{{ portsuffix }};
        end

        out{{ portsuffix }} <= mem[internal_addr{{ portsuffix }}];
        {%- endif %}
    end
{%- endmacro -%}
module {{ module.name }} (
    input wire [0:0] clk
    {% if module.dualport -%}
        {{ memport('1', module.addr_width, module.data_width) }}
        {{ memport('2', module.addr_width, module.data_width) }}
    {%- else -%}
        {{ memport('', module.addr_width, module.data_width) }}
    {%- endif %}
    );

    reg [{{ module.data_width - 1}}:0] mem [0:{{ 2 ** module.addr_width - 1 }}];

    {% if module.dualport -%}
        {{ memproc('1', module.addr_width, module.transparent) }}

        {{ memproc('2', module.addr_width, module.transparent) }}
    {%- else -%}
        {{ memproc('', module.addr_width, module.transparent) }}
    {%- endif %}

endmodule

