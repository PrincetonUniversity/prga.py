// Automatically generated by PRGA's RTL generator

/*
* RXI hardware-sync'ed register (HSR) input FIFO.
*/

`include "prga_rxi.vh"
`default_nettype none

module prga_rxi_fe_iq #(
    parameter   FIFO_DEPTH_LOG2
) (
    // -- System Ctrl --------------------------------------------------------
    input wire                                          clk
    , input wire                                        rst

    // -- Push ---------------------------------------------------------------
    , input wire [`PRGA_RXI_NUM_HSR_IQS-1:0]            wr  // one-hot write enable
    , input wire [`PRGA_RXI_DATA_WIDTH-1:0]             din
    , output wire [`PRGA_RXI_NUM_HSR_IQS-1:0]           full

    // -- Pop (and arbitration) ----------------------------------------------
    , input wire                                        rdy
    , output wire [`PRGA_RXI_HSR_IQ_ID_WIDTH-1:0]       id
    , output reg                                        vld
    , output reg [`PRGA_RXI_DATA_WIDTH-1:0]             data
    );

    // -- FIFOs --------------------------------------------------------------
    wire [`PRGA_RXI_NUM_HSR_IQS-1:0]    empty;
    wire [`PRGA_RXI_DATA_WIDTH-1:0]     dout [0:`PRGA_RXI_NUM_HSR_IQS-1];

    genvar gv_iq;
    generate
        for (gv_iq = 0; gv_iq < `PRGA_RXI_NUM_HSR_IQS; gv_iq = gv_iq + 1) begin: g_iq
            prga_fifo #(
                .DEPTH_LOG2     (FIFO_DEPTH_LOG2)
                ,.DATA_WIDTH    (`PRGA_RXI_DATA_WIDTH)
                ,.LOOKAHEAD     (1)
            ) i_iq (
                .clk            (clk)
                ,.rst           (rst)
                ,.full          (full[gv_iq])
                ,.wr            (wr[gv_iq])
                ,.din           (din)
                ,.empty         (empty[gv_iq])
                ,.rd            (rdy && id == gv_iq)
                ,.dout          (dout[gv_iq])
                );
        end
    endgenerate

    always @* begin
        vld = ~rst && ~empty[id];
        data = dout[id];
    end

    // -- Arbitration --------------------------------------------------------
    prga_arb_robinfair #(
        .INDEX_WIDTH    (`PRGA_RXI_HSR_IQ_ID_WIDTH)
    ) i_arb (
        .clk            (clk)
        ,.rst_n         (~rst)
        ,.ce            (rdy && vld)
        ,.candidates    (~empty)
        ,.current       (id)
        );

endmodule
